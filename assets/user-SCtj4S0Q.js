import{N as n,g as o}from"./index-M2XYBmvA.js";import{S as i}from"./sweetalert2.all--Pq_NLg4.js";import{a as h}from"./helpers-Hx-ZzB2u.js";const p=n("userStore",{state:()=>({user:null,carts:[],favorites:[]}),getters:{getUser:({user:e})=>e,getFavorites:({favorites:e})=>e||[],getCarts:({carts:e})=>e||[]},actions:{setUser(e){this.user={...e},this.reGetAllData()},getUserCookie(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)userToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),s=document.cookie.replace(/(?:(?:^|.*;\s*)userId\s*=\s*([^;]*).*$)|^.*$/,"$1");return{userToken:e||null,userId:parseInt(s,10)||null}},reGetAllData(){this.resetUserFavorites(),this.resetUserCarts()},resetUserFavorites(){var e;(e=this.user)!=null&&e.id&&o.get(`https://vue3-course-api.hexschool.io/v2/favorite?userId=${this.user.id}`).then(s=>{this.favorites=s.data.map(t=>t.productId)}).catch(s=>{console.log(s.response)})},resetUserCarts(){var e;(e=this.user)!=null&&e.id&&o.get(`https://vue3-course-api.hexschool.io/v2/carts?userId=${this.user.id}`).then(s=>{this.carts=s.data}).catch(s=>{console.log(s.response)})},addToCart(e){var s;if(e!=null&&e.id&&((s=this.user)!=null&&s.id)){const t=this.carts.findIndex(r=>r.product_id===e.id&&r.userId===this.user.id);if(t>-1){const r=this.carts[t].id;this.carts[t].qty+=1;const a={qty:this.carts[t].qty};o.patch(`https://vue3-course-api.hexschool.io/v2/carts/${r}`,a).then(c=>{this.resetUserCarts(),i.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(c=>{console.log(c.response),i.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}else{const r={product_id:e.id,chineseName:e.chineseName,image:e.image,price:e.price,is_hot:e.is_hot,star:e.star,qty:1,userId:this.user.id};o.post("https://vue3-course-api.hexschool.io/v2/carts",r).then(a=>{this.resetUserCarts(),i.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{i.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}}},addToFavorite(e){o.post("https://vue3-course-api.hexschool.io/v2/favorite",e).then(s=>{this.resetUserFavorites(),i.fire({title:"收藏成功",text:"",icon:"success"})}).catch(s=>{console.log(s.response),i.fire({title:"收藏失敗",text:"",icon:"error"})})},setUserCookie(e,s){const t=h(new Date,2);document.cookie=`userToken=${s}; expires=${new Date(t)}; path=/`,document.cookie=`userId=${e}; expires=${new Date(t)}; path=/`},cleanUser(){this.user=null,document.cookie=`userToken=0; expires=${new Date("2000/1/1 12:00")}; path=/`,document.cookie=`userId=0; expires=${new Date("2000/1/1 12:00")}; path=/`}}});export{p as u};
